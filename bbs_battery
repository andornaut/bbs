#!/bin/bash

set -e -o pipefail

output="$(acpi --battery 2>&1)"
if [[ $? -ne 0 || "${output}" == "No support for device type"* ]]; then
	exit 1
fi

if [[ "${output}" = *Discharging* ]]; then
    icon="${ICON_BATTERY_DISCHARGING}"
else
    icon="${ICON_BATTERY_PLUGGED_IN}"
fi

printf '%s %0.0f\n' "${icon}" "$(echo "${output}"|awk -F, '{s+=$2}END{print "",s/NR}')"
